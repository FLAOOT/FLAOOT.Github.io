<!DOCTYPE html>
<html>
<head>
    <title>Web Minecraft</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        #hud {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 100;
        }
        .slot {
            width: 64px;
            height: 64px;
            border: 2px solid #555;
            background: rgba(0,0,0,0.7);
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
        }
        .active { border-color: gold; }
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            pointer-events: none;
        }
        #crafting {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="hud"></div>
    <div id="crosshair">+</div>
    <div id="crafting">
        <h3 style="color:white;">Crafting</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 64px); gap: 5px;">
            <div class="craft-slot" data-index="0"></div>
            <div class="craft-slot" data-index="1"></div>
            <div class="craft-slot" data-index="2"></div>
            <div class="craft-slot" data-index="3"></div>
        </div>
        <div style="margin-top: 10px;">→</div>
        <div class="result-slot"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>
    <script>
        let scene, camera, renderer, controls;
        let blocks = new Map();
        let inventory = Array(9).fill(null);
        let craftingSlots = Array(4).fill(null);
        let currentBlockType = 'grass';
        const BLOCK_SIZE = 1;
        const MOVEMENT_SPEED = 0.1;
        const MOUSE_SENSITIVITY = 0.002;
        let moveState = { forward: false, backward: false, left: false, right: false };

        // Текстуры и материалы
        const materials = {
            grass: loadMaterial('https://i.ibb.co/7Q6MZe1/grass.png'),
            dirt: loadMaterial('https://i.ibb.co/7Q6MZe1/dirt.png'),
            stone: loadMaterial('https://i.ibb.co/3RXjJ6z/stone.png'),
            wood: loadMaterial('https://i.ibb.co/4n1BfT5/wood.png'),
            plank: loadMaterial('https://i.ibb.co/0j7Z4q8/plank.png')
        };

        // Рецепты крафта
        const recipes = [
            {
                input: ['wood', 'wood', null, 'wood'],
                output: { type: 'plank', count: 4 }
            }
        ];

        function loadMaterial(url) {
            const texture = new THREE.TextureLoader().load(url);
            return new THREE.MeshStandardMaterial({ map: texture });
        }

        async function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Освещение
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(100, 100, 100);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // Генерация мира
            generateWorld();
            loadSave();

            // Управление
            setupControls();
            updateInventory();
            animate();
        }

        function generateWorld() {
            // Генерация базовой земли
            for(let x = -10; x <= 10; x++) {
                for(let z = -10; z <= 10; z++) {
                    addBlock(x, -1, z, 'grass');
                    for(let y = -2; y >= -5; y--) {
                        addBlock(x, y, z, 'dirt');
                    }
                }
            }
        }

        function addBlock(x, y, z, type) {
            const key = `${x},${y},${z}`;
            if(blocks.has(key)) return;

            const geometry = new THREE.BoxGeometry(BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            const cube = new THREE.Mesh(geometry, materials[type]);
            cube.position.set(x, y, z);
            scene.add(cube);
            
            blocks.set(key, { type, mesh: cube });
        }

        function removeBlock(x, y, z) {
            const key = `${x},${y},${z}`;
            if(!blocks.has(key)) return;

            const block = blocks.get(key);
            scene.remove(block.mesh);
            blocks.delete(key);
            addToInventory(block.type);
        }

        function addToInventory(type, count = 1) {
            const slot = inventory.findIndex(s => s?.type === type);
            if(slot > -1) {
                inventory[slot].count += count;
            } else {
                const emptySlot = inventory.findIndex(s => !s);
                if(emptySlot > -1) {
                    inventory[emptySlot] = { type, count };
                }
            }
            updateInventory();
        }

        function updateInventory() {
            const hud = document.getElementById('hud');
            hud.innerHTML = '';
            inventory.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = `slot ${index === 0 ? 'active' : ''}`;
                if(item) {
                    slot.style.backgroundImage = `url(${materials[item.type].map.image.src})`;
                    slot.innerHTML = `<div>${item.count}</div>`;
                }
                slot.addEventListener('click', () => selectSlot(index));
                hud.appendChild(slot);
            });
        }

        function selectSlot(index) {
            currentBlockType = inventory[index]?.type;
            document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.slot')[index].classList.add('active');
        }

        function setupControls() {
            controls = new THREE.PointerLockControls(camera, document.body);
            scene.add(controls.getObject());
            camera.position.set(0, 5, 0);

            document.addEventListener('keydown', e => {
                if(e.key === 'e') document.getElementById('crafting').style.display = 'block';
                if(e.key === 'Escape') document.getElementById('crafting').style.display = 'none';
                // ... остальные обработчики ...
            });

            // ... остальные настройки управления ...
        }

        function checkCrafting() {
            const recipe = recipes.find(r => 
                r.input.every((item, index) => 
                    item === craftingSlots[index]?.type
                )
            );
            if(recipe) {
                // Обновляем слот результата
            }
        }

        function saveGame() {
            localStorage.setItem('save', JSON.stringify({
                inventory,
                blocks: Array.from(blocks).map(([key, val]) => ({
                    pos: key.split(',').map(Number),
                    type: val.type
                }))
            }));
        }

        function loadSave() {
            const save = JSON.parse(localStorage.getItem('save'));
            if(save) {
                inventory = save.inventory;
                save.blocks.forEach(({pos, type}) => addBlock(...pos, type));
            }
        }

        // ... остальные функции ...

        init();
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
