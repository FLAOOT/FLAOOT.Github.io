<!DOCTYPE html>
<html>
<head>
    <title>Secure Browser</title>
    <style>
        /* Все предыдущие стили остаются */
        .proxy-warning {
            background: #ffeb3b;
            color: #000;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="proxy-warning" id="proxyWarning">
        Используется безопасный прокси-доступ. Некоторые функции могут быть ограничены.
    </div>

    <!-- Остальная разметка без изменений -->

    <script>
        const PROXY_URL = 'https://cors-anywhere.herokuapp.com/';
        let useProxy = false;

        async function navigate() {
            const urlInput = document.getElementById('urlInput');
            let url = urlInput.value.trim();
            
            if (!url) return;

            // Автоматическое определение необходимости прокси
            if (url.includes('google.com') || url.includes('youtube.com')) {
                useProxy = true;
                document.getElementById('proxyWarning').style.display = 'block';
            }

            try {
                const finalUrl = useProxy ? PROXY_URL + url : url;
                const frame = document.getElementById(`frame_${currentTab}`);
                
                // Проверка безопасности URL
                if (!isValidUrl(finalUrl)) {
                    throw new Error('Недопустимый URL');
                }

                frame.src = finalUrl;
                tabs[currentTab].url = finalUrl;
                addToHistory(finalUrl);
            } catch (error) {
                showError(error.message);
            }
        }

        function search(type) {
            const query = document.getElementById('urlInput').value.trim();
            const engine = useProxy ? 'https://duckduckgo.com/' : 'https://google.com/';
            
            const searchPaths = {
                images: 'iax=images&ia=images',
                videos: 'iax=videos&ia=videos',
                music: 'iax=music&ia=music',
                news: 'iar=news&ia=news'
            };
            
            const searchUrl = `${engine}?q=${encodeURIComponent(query)}&${searchPaths[type] || ''}`;
            navigateToUrl(searchUrl);
        }

        function navigateToUrl(url) {
            const frame = document.getElementById(`frame_${currentTab}`);
            try {
                frame.src = useProxy ? PROXY_URL + url : url;
                tabs[currentTab].url = url;
                addToHistory(url);
            } catch (error) {
                showError('Ошибка загрузки страницы');
            }
        }

        // Обновленная проверка URL
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return ['http:', 'https:'].includes(url.protocol);
            } catch (_) {
                return false;
            }
        }
    </script>
</body>
</html>
