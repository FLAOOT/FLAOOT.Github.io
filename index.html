<!DOCTYPE html>
<html>
<head>
    <title>Working Minecraft FPS</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="crosshair">+</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let moveSpeed = 5;
        let lookSpeed = 0.002;
        let yaw = Math.PI;
        let pitch = 0;
        let blocks = new Map();
        const BLOCK_SIZE = 1;

        function init() {
            // 1. Инициализация сцены
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            
            // 2. Создание камеры
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 0);
            
            // 3. Создание рендерера
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 4. Добавление освещения
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(100, 100, 100);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // 5. Создание земли
            createGround();

            // 6. Настройка управления
            document.addEventListener('click', () => {
                document.body.requestPointerLock();
            });

            document.addEventListener('mousemove', (e) => {
                if(document.pointerLockElement === document.body) {
                    yaw -= e.movementX * lookSpeed;
                    pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch - e.movementY * lookSpeed));
                    camera.rotation.set(pitch, yaw, 0, 'YXZ');
                }
            });

            // 7. Обработка клавиш
            const keys = {};
            document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
            document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

            // 8. Главный цикл
            let lastTime = performance.now();
            function animate() {
                const time = performance.now();
                const delta = (time - lastTime) * 0.001;
                lastTime = time;

                // Движение
                if(document.pointerLockElement === document.body) {
                    const direction = new THREE.Vector3();
                    if(keys['w']) direction.z -= 1;
                    if(keys['s']) direction.z += 1;
                    if(keys['a']) direction.x -= 1;
                    if(keys['d']) direction.x += 1;
                    if(keys[' ']) camera.position.y += moveSpeed * delta;

                    direction.normalize();
                    direction.applyEuler(new THREE.Euler(0, yaw, 0));
                    camera.position.add(direction.multiplyScalar(moveSpeed * delta));
                }

                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            }
            animate();
        }

        function createGround() {
            const geometry = new THREE.BoxGeometry(BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            const material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
            
            for(let x = -10; x <= 10; x++) {
                for(let z = -10; z <= 10; z++) {
                    const cube = new THREE.Mesh(geometry, material);
                    cube.position.set(x, -1, z);
                    scene.add(cube);
                    blocks.set(`${x},-1,${z}`, cube);
                }
            }
        }

        // Запуск
        init();
    </script>
</body>
</html>
